{
  "version": 3,
  "sources": ["../src/hide_seen_rows.js"],
  "sourcesContent": ["/**\n * @param HTMLAnchorElement link\n */\nexport function calcLinkScore(link) {\n    const relativePath = link.pathname + link.search\n    const searchParams = new URLSearchParams(link.search)\n    const paramKeys = searchParams.keys()\n\n    let score = 0\n\n    if (link.innerText && link.innerText.length > 10) {\n        score += 2\n    }\n\n    if (link.title) {\n        score += 1\n    }\n\n    if (link.pathname.includes('download')) {\n        score += 0.5\n    }\n\n    if (link.protocol in ['javascript:', 'magnet:']) {\n        score -= 1\n    }\n\n    if (relativePath.length > 100) {\n        score -= 2\n    }\n\n    if (hasAnySubstringInParamKeys(paramKeys, ['category', 'cat'])) {\n        score -= 5\n    }\n\n    if (relativePath.length < 5) {\n        score -= 200\n    }\n\n    return score\n}\n\nexport function sortByPriority(links) {\n    if ('sort' in links)\n        links.sort((a, b) => calcLinkScore(b) - calcLinkScore(a))\n    else\n        links.values().toArray().sort((a, b) => calcLinkScore(b) - calcLinkScore(a))\n    return links\n}\n\nfunction hasAnySubstringInParamKeys(paramKeys, substrings) {\n    for (const key of paramKeys) {\n        for (const substring of substrings) {\n            if (key.includes(substring)) {\n                return true\n            }\n        }\n    }\n    return false\n}\n\n(function () {\n    'use strict'\n\n    let sliderHtml = `\n        <div id=\"hide_seen_rows\" style=\"\n            position: fixed;\n            bottom: 10px;\n            left: 0;\n            background: rgba(255, 255, 255, 0.8);\n            padding: 10px;\n            border-radius: 5px;\n            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);\n            z-index: 1000;\n            \">\n            <details><summary>h</summary>\n            <input type=\"range\" id=\"timeThresholdSlider\" min=\"0\" max=\"300\" value=\"0\">\n                <span id=\"timeThresholdDisplay\" style=\"width: 200px;\"></span>\n            </details>\n        </div>\n    `\n\n    let container = document.createElement('div')\n    container.innerHTML = sliderHtml\n    document.body.appendChild(container)\n\n    document.getElementById('timeThresholdSlider').addEventListener('input', function () {\n        let thresholdHours = getTimeThreshold()\n        let displayText = ''\n        if (thresholdHours === undefined) {\n            displayText = 'disabled'\n        } else {\n            let days = Math.floor(thresholdHours / 24)\n            let hours = Math.floor(thresholdHours % 24)\n\n            if (days > 0) {\n                displayText += days + ' day' + (days > 1 ? 's' : '')\n            }\n\n            if (hours > 0 || days === 0) {\n                displayText += ' ' + hours + ' hour' + (hours > 1 ? 's' : '')\n            }\n        }\n\n        document.getElementById('timeThresholdDisplay').textContent = displayText\n        hideRows()\n    })\n\n    function getTimeThreshold() {\n        let slider = document.getElementById('timeThresholdSlider')\n        if (slider.value === slider.max) return\n        let value = parseFloat(slider.value)\n        return value\n    }\n\n    function hideRows() {\n        let rows = getRows()\n        let thresholdHours = getTimeThreshold()\n\n        rows.forEach(row => {\n            let identifier = getRowIdentifier(row)\n            if (identifier) {\n                identifier.style.color = 'unset'\n                let storedValue = localStorage.getItem(identifier)\n                if (storedValue) {\n                    let timestamp = parseInt(storedValue, 10)\n                    if (!isNaN(timestamp)) {\n                        let timeDifference = Date.now() - timestamp\n                        let hoursDifference = timeDifference / (1000 * 60 * 60)\n                        if (hoursDifference > thresholdHours) {\n                            identifier.style.color = '#888 !important'\n                        }\n                    }\n                }\n            }\n        })\n    }\n\n    function getRowIdentifier(row) {\n        let links = row.querySelectorAll('a')\n\n        if (links.length === 0) {\n            return null\n        }\n\n        return sortByPriority(links)[0]\n    }\n\n    function findTableWithMostRows() {\n        let tables = document.querySelectorAll('table')\n        let maxRows = 0\n        let tableWithMostRows = null\n\n        tables.forEach(table => {\n            let rows = table.querySelectorAll('tr')\n            let directRows = Array.from(rows).filter(row => row.parentElement === table || (row.parentElement.tagName === 'TBODY' && row.parentElement.parentElement === table))\n            if (directRows.length > maxRows) {\n                maxRows = directRows.length\n                tableWithMostRows = table\n            }\n        })\n\n        if (maxRows == 0) {\n            document.getElementById('hide_seen_rows').style.display = \"none\"\n        } else {\n            document.getElementById('hide_seen_rows').style.display = \"block\"\n        }\n\n        return tableWithMostRows\n    }\n\n    function getRows() {\n        let tableWithMostRows = findTableWithMostRows()\n        if (tableWithMostRows) {\n            return tableWithMostRows.querySelectorAll('tr')\n        }\n        return []\n    }\n\n    function markRowsAsSeen() {\n        let rows = getRows()\n        rows.forEach(row => {\n            let identifier = getRowIdentifier(row)\n            if (identifier) {\n                console.log(identifier)\n                let storedValue = localStorage.getItem(identifier)\n                if (!storedValue || isNaN(parseInt(storedValue, 10))) {\n                    localStorage.setItem(identifier, Date.now().toString())\n                }\n            }\n        })\n    }\n\n    hideRows()\n    markRowsAsSeen()\n})()\n"],
  "mappings": "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",
  "names": []
}
